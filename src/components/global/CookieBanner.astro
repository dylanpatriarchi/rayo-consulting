---
import { getLangFromUrl, useTranslations, useTranslatedPath } from "@i18n/utils";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);
---

<div id="cookie-banner" class="fixed bottom-0 left-0 right-0 z-50 bg-black border-t border-gray-700 p-4 transform translate-y-full transition-transform duration-500">
	<div class="max-w-7xl mx-auto flex flex-col sm:flex-row items-center justify-between gap-4">
		<div class="flex-1 text-sm text-gray-300">
			{lang === "it" ? (
				<p>
					Utilizziamo cookie tecnici per migliorare la tua esperienza di navigazione. 
					<a href={translatePath("/cookies/")} class="text-white hover:text-gray-300 underline">
						Scopri di pi√π
					</a>
				</p>
			) : (
				<p>
					We use technical cookies to improve your browsing experience. 
					<a href={translatePath("/cookies/")} class="text-white hover:text-gray-300 underline">
						Learn more
					</a>
				</p>
			)}
		</div>
		<div class="flex gap-3">
			<button 
				id="cookie-accept" 
				class="bg-white hover:bg-gray-200 text-black font-mono font-bold px-6 py-2 transition-colors uppercase text-sm"
			>
				{lang === "it" ? "Accetta" : "Accept"}
			</button>
			<button 
				id="cookie-decline" 
				class="border border-gray-600 hover:border-white text-white hover:text-white font-mono font-bold px-6 py-2 transition-colors uppercase text-sm"
			>
				{lang === "it" ? "Rifiuta" : "Decline"}
			</button>
		</div>
	</div>
</div>

<script>
	function initCookieBanner() {
		const banner = document.getElementById('cookie-banner');
		const acceptBtn = document.getElementById('cookie-accept');
		const declineBtn = document.getElementById('cookie-decline');
		
		if (!banner || !acceptBtn || !declineBtn) return;

		// Check if user has already made a choice
		const cookieConsent = localStorage.getItem('cookie-consent');
		
		if (!cookieConsent) {
			// Show banner after a short delay
			setTimeout(() => {
				banner.classList.remove('translate-y-full');
			}, 1000);
		}

		// Handle accept
		acceptBtn.addEventListener('click', () => {
			localStorage.setItem('cookie-consent', 'accepted');
			hideBanner();
			// Enable analytics or other tracking here
			console.log('Cookies accepted');
		});

		// Handle decline
		declineBtn.addEventListener('click', () => {
			localStorage.setItem('cookie-consent', 'declined');
			hideBanner();
			// Disable analytics or other tracking here
			console.log('Cookies declined');
		});

		function hideBanner() {
			banner.classList.add('translate-y-full');
		}
	}

	// Initialize on page load
	document.addEventListener('DOMContentLoaded', initCookieBanner);
	
	// Re-initialize on page navigation (for Astro)
	document.addEventListener('astro:page-load', initCookieBanner);
</script> 